
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamepad Tester</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Global Styles --- */
        body {
            font-family: 'Inter', sans-serif; /* Use Inter font */
            background-color: #1e1e1e;
            color: #f0f0f0;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
            font-size: 16px; /* Base font size */
        }

        h1, h2, h3 {
            font-weight: 500; /* Adjusted for Inter */
            color: #00aaff;
            border-bottom: 1px solid #444;
            padding-bottom: 5px;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        
        h1 {
            font-size: 2.2em;
            margin-bottom: 30px;
        }
        h2 {
            font-size: 1.8em;
        }
        h3 {
            font-size: 1.4em;
        }

        /* --- Main Layout --- */
        #tester-container {
            display: none; /* Hidden until a controller connects */
            width: 100%;
            max-width: 960px; /* Increased max-width for visualizer */
            background-color: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            display: grid;
            grid-template-columns: 1fr 300px; /* Main content and visualizer */
            gap: 30px;
        }

        #status {
            font-size: 1.2em;
            text-align: center;
            padding: 30px;
            border: 2px dashed #555;
            border-radius: 8px;
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
        }
        
        .connected {
            border-color: #00aaff !important;
        }

        #controller-name {
            text-align: center;
            margin-top: 0;
            font-size: 1.5em;
        }

        .details {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: space-between;
        }

        /* --- Buttons Section --- */
        #buttons {
            flex-basis: 300px; /* Allow buttons to wrap */
            flex-grow: 1;
        }

        #button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
        }

        .button {
            border: 1px solid #555;
            border-radius: 4px;
            padding: 10px;
            text-align: center;
            font-weight: 600; /* Adjusted for Inter */
            font-size: 0.9em;
            background-color: #333;
            transition: all 0.05s ease;
            white-space: nowrap; /* Prevent B# from wrapping */
        }
        
        .button .value {
            display: block;
            font-size: 0.8em;
            color: #aaa;
            margin-top: 4px;
            font-weight: 400; /* Adjusted for Inter */
        }

        .button.pressed {
            background-color: #0078d7;
            color: white;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0, 120, 215, 0.7); /* Softer glow */
        }

        .button.pressed .value {
            color: #fff;
        }

        /* --- Axes Section --- */
        #axes {
            flex-basis: 300px;
            flex-grow: 1;
        }
        
        .axes-container {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            margin-top: 20px;
        }

        .stick {
            text-align: center;
        }
        
        .stick canvas {
            background-color: #111;
            border: 2px solid #555;
            border-radius: 50%;
            width: 120px;
            height: 120px;
        }
        
        .stick-values {
            font-family: 'Inter', sans-serif; /* Keep Inter for consistency */
            font-size: 0.9em;
            margin-top: 10px;
            color: #ccc;
            line-height: 1.4;
        }

        /* --- Vibration Section --- */
        #vibration {
            display: none; /* Hidden if controller doesn't support it */
            margin-top: 20px;
            text-align: center; /* Center vibration buttons */
        }

        #vibration button {
            background-color: #0078d7;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            font-size: 1em;
            cursor: pointer;
            margin: 0 5px; /* Adjust margin */
            transition: background-color 0.2s;
        }

        #vibration button:hover {
            background-color: #005a9e;
        }

        /* --- Gamepad Visualizer --- */
        #gamepad-visualizer {
            grid-column: 2; /* Place in the second column */
            background-color: #333;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        #gamepad-svg {
            width: 100%;
            height: auto;
            max-width: 280px; /* Constrain SVG size */
            margin-bottom: 20px;
            /* Ensure the SVG itself doesn't have a background to show #gamepad-visualizer's background */
            background-color: transparent; 
        }
        
        /* SVG general styles */
        #gamepad-svg .outline-part {
            fill: none;
            stroke: #999; /* Lighter outline for clarity */
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        #gamepad-svg .body-fill {
            fill: #444; /* Darker body fill */
            stroke: none;
        }
        
        #gamepad-svg .button-fill {
            fill: #666; /* Default button fill */
            transition: fill 0.05s ease-out;
            stroke: #777; /* Slight stroke for button definition */
            stroke-width: 1;
        }
        
        #gamepad-svg .stick-pos {
            fill: #00aaff;
            transition: transform 0.05s ease-out;
            transform-origin: center center;
            stroke: #fff;
            stroke-width: 2;
        }
        
        #gamepad-svg .active-fill {
            fill: #00aaff; /* Highlight color */
        }
        
        /* Triggers special styling to reset stroke */
        #gamepad-svg #button_L2_fill, #gamepad-svg #button_R2_fill {
            stroke: #777; /* Default stroke for triggers */
        }

        /* Media queries for smaller screens */
        @media (max-width: 768px) {
            #tester-container {
                grid-template-columns: 1fr; /* Stack content and visualizer */
            }
            #gamepad-visualizer {
                grid-column: 1; /* Move to first column */
            }
            .details {
                flex-direction: column;
                align-items: center;
            }
            .stick canvas {
                width: 100px;
                height: 100px;
            }
            #vibration {
                flex-wrap: wrap;
                justify-content: center;
            }
            #vibration button {
                margin: 5px;
            }
        }
    </style>
</head>
<body>

    <h1>Gamepad Tester</h1>

    <div id="status">
        Please connect a controller and press any button to start.
    </div>

    <div id="tester-container">
        <div>
            <h2 id="controller-name"></h2>
            
            <div class="details">
                <div id="buttons">
                    <h3>Buttons</h3>
                    <div id="button-grid">
                    </div>
                </div>

                <div id="axes">
                    <h3>Analog Sticks</h3>
                    <div class="axes-container">
                        <div class="stick">
                            <strong>Left Stick</strong>
                            <canvas id="l-stick" width="120" height="120"></canvas>
                            <div id="l-stick-values" class="stick-values">
                                Axis 0: 0.0000<br>
                                Axis 1: 0.0000
                            </div>
                        </div>
                        <div class="stick">
                            <strong>Right Stick</strong>
                            <canvas id="r-stick" width="120" height="120"></canvas>
                            <div id="r-stick-values" class="stick-values">
                                Axis 2: 0.0000<br>
                                Axis 3: 0.0000
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="vibration">
                <h3>Vibration (Rumble)</h3>
                <button id="vibrate-1s">Vibration, 1 sec</button>
                <button id="vibrate-inf">Vibration, infinite</button>
                <button id="vibrate-stop">Stop Vibration</button>
            </div>
        </div>

        <div id="gamepad-visualizer">
            <h3>Visualizer</h3>
            <svg id="gamepad-svg" viewBox="0 0 300 200" xmlns="http://www.w3.org/2000/svg">
                <path class="body-fill" d="M 25 80 Q 5 70 10 50 Q 15 20 60 15 H 240 Q 285 20 290 50 Q 295 70 275 80 C 265 150 240 190 150 190 C 60 190 35 150 25 80 Z" />
                <path class="outline-part" d="M 25 80 Q 5 70 10 50 Q 15 20 60 15 H 240 Q 285 20 290 50 Q 295 70 275 80 C 265 150 240 190 150 190 C 60 190 35 150 25 80 Z" />
                
                <g id="left-stick-group">
                    <circle class="outline-part" cx="80" cy="65" r="15"/>
                    <circle id="left-stick-pos" class="stick-pos" cx="80" cy="65" r="8"/>
                    <circle id="button_LThumb_fill" class="button-fill" cx="80" cy="65" r="15" fill="transparent"/> </g>

                <g id="right-stick-group">
                    <circle class="outline-part" cx="200" cy="130" r="15"/>
                    <circle id="right-stick-pos" class="stick-pos" cx="200" cy="130" r="8"/>
                    <circle id="button_RThumb_fill" class="button-fill" cx="200" cy="130" r="15" fill="transparent"/> </g>

                <g id="dpad-group">
                    <rect id="dpad_left_fill" class="button-fill" x="60" y="120" width="15" height="20"/>
                    <rect id="dpad_right_fill" class="button-fill" x="90" y="120" width="15" height="20"/>
                    <rect id="dpad_up_fill" class="button-fill" x="75" y="105" width="20" height="15"/>
                    <rect id="dpad_down_fill" class="button-fill" x="75" y="135" width="20" height="15"/>
                    <path class="outline-part" d="M75 105h20v15h15v20h-15v15h-20v-15h-15v-20h15z"/>
                </g>

                <g id="action-buttons-group">
                    <circle id="button_Y_fill" class="button-fill" cx="215" cy="65" r="10"/>
                    <circle id="button_B_fill" class="button-fill" cx="235" cy="85" r="10"/>
                    <circle id="button_A_fill" class="button-fill" cx="215" cy="105" r="10"/>
                    <circle id="button_X_fill" class="button-fill" cx="195" cy="85" r="10"/>
                    <circle class="outline-part" cx="215" cy="65" r="10"/>
                    <circle class="outline-part" cx="235" cy="85" r="10"/>
                    <circle class="outline-part" cx="215" cy="105" r="10"/>
                    <circle class="outline-part" cx="195" cy="85" r="10"/>
                </g>

                <g id="middle-buttons-group">
                    <circle id="button_Select_fill" class="button-fill" cx="120" cy="90" r="6"/>
                    <circle id="button_Start_fill" class="button-fill" cx="180" cy="90" r="6"/>
                    <circle id="button_Home_fill" class="button-fill" cx="150" cy="90" r="9"/>
                    <circle class="outline-part" cx="120" cy="90" r="6"/>
                    <circle class="outline-part" cx="180" cy="90" r="6"/>
                    <circle class="outline-part" cx="150" cy="90" r="9"/>
                </g>

                <g id="bumpers-group">
                    <path id="button_L1_fill" class="button-fill" d="M 60 15 Q 40 10 35 25 L 35 45 Q 40 50 60 50 H 120 Q 125 45 125 35 L 125 25 Q 120 15 100 15 Z"/>
                    <path id="button_R1_fill" class="button-fill" d="M 240 15 Q 260 10 265 25 L 265 45 Q 260 50 240 50 H 180 Q 175 45 175 35 L 175 25 Q 180 15 200 15 Z"/>
                </g>

                <g id="triggers-group">
                    <path id="button_L2_fill" class="button-fill" d="M 40 0 Q 30 10 30 20 L 30 35 Q 40 45 60 45 H 100 Q 110 35 110 20 L 110 10 Q 100 0 80 0 Z"/>
                    <path id="button_R2_fill" class="button-fill" d="M 260 0 Q 270 10 270 20 L 270 35 Q 260 45 240 45 H 200 Q 190 35 190 20 L 190 10 Q 200 0 220 0 Z"/>
                </g>
            </svg>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const statusEl = document.getElementById('status');
        const containerEl = document.getElementById('tester-container');
        const controllerNameEl = document.getElementById('controller-name');
        const buttonGridEl = document.getElementById('button-grid');
        const vibrationEl = document.getElementById('vibration');

        // Stick 1 (Left)
        const lStickCanvas = document.getElementById('l-stick');
        const lStickCtx = lStickCanvas.getContext('2d');
        const lStickValuesEl = document.getElementById('l-stick-values');

        // Stick 2 (Right)
        const rStickCanvas = document.getElementById('r-stick');
        const rStickCtx = rStickCanvas.getContext('2d');
        const rStickValuesEl = document.getElementById('r-stick-values');
        
        // Vibration Buttons
        const vibrate1sBtn = document.getElementById('vibrate-1s');
        const vibrateInfBtn = document.getElementById('vibrate-inf');
        const vibrateStopBtn = document.getElementById('vibrate-stop');

        // --- Gamepad Visualizer SVG Elements ---
        const svgGamepad = document.getElementById('gamepad-svg');
        const svgLeftStickPos = document.getElementById('left-stick-pos');
        const svgRightStickPos = document.getElementById('right-stick-pos');
        
        // Base positions for sticks (from SVG cx, cy attributes)
        const baseLeftStickX = 80;
        const baseLeftStickY = 65;
        const baseRightStickX = 200;
        const baseRightStickY = 130;

        // Mapping of Gamepad API button index to SVG element ID
        // Standard Gamepad (like Xbox) button mapping:
        // 0: A, 1: B, 2: X, 3: Y
        // 4: L1 (Left Bumper), 5: R1 (Right Bumper)
        // 6: L2 (Left Trigger), 7: R2 (Right Trigger)
        // 8: Select/Back, 9: Start/Menu
        // 10: L3 (Left Stick Click), 11: R3 (Right Stick Click)
        // 12: DPad Up, 13: DPad Down, 14: DPad Left, 15: DPad Right
        // 16: Home/Guide Button (often not reported or handled differently)
        const buttonMap = {
            0: 'button_A_fill',
            1: 'button_B_fill',
            2: 'button_X_fill',
            3: 'button_Y_fill',
            4: 'button_L1_fill',
            5: 'button_R1_fill',
            6: 'button_L2_fill', // Triggers are also buttons with value
            7: 'button_R2_fill', // Triggers are also buttons with value
            8: 'button_Select_fill',
            9: 'button_Start_fill',
            10: 'button_LThumb_fill',
            11: 'button_RThumb_fill',
            12: 'dpad_up_fill',
            13: 'dpad_down_fill',
            14: 'dpad_left_fill',
            15: 'dpad_right_fill',
            16: 'button_Home_fill' // If your gamepad reports this
        };

        // --- State ---
        let connectedGamepad = null;
        let animationFrameId = null;

        // --- Gamepad API Event Listeners ---
        
        window.addEventListener("gamepadconnected", (event) => {
            console.log("Gamepad connected:", event.gamepad);
            // In case multiple gamepads connect, we'll focus on the first one
            // or the most recently connected if no other is active.
            if (!connectedGamepad) {
                 connectedGamepad = event.gamepad;
            } else if (event.gamepad.index === 0) { // Prioritize gamepad 0
                connectedGamepad = event.gamepad;
            } else if (!navigator.getGamepads()[connectedGamepad.index]) { // If our current one disconnected
                 connectedGamepad = event.gamepad;
            }
            
            setupTesterUI(connectedGamepad);
            if (!animationFrameId) {
                startUpdateLoop();
            }
        });

        window.addEventListener("gamepaddisconnected", (event) => {
            console.log("Gamepad disconnected:", event.gamepad);
            if (connectedGamepad && connectedGamepad.index === event.gamepad.index) {
                connectedGamepad = null;
                resetTesterUI();
                stopUpdateLoop();
            }
            // Check if there are other gamepads to switch to
            const gamepads = navigator.getGamepads();
            for (let i = 0; i < gamepads.length; i++) {
                if (gamepads[i]) {
                    connectedGamepad = gamepads[i];
                    setupTesterUI(connectedGamepad);
                    startUpdateLoop(); // Restart with new gamepad
                    return;
                }
            }
        });

        // Initial check for already connected gamepads on page load
        if (navigator.getGamepads) {
            const gamepads = navigator.getGamepads();
            for (let i = 0; i < gamepads.length; i++) {
                if (gamepads[i]) {
                    connectedGamepad = gamepads[i];
                    setupTesterUI(connectedGamepad);
                    startUpdateLoop();
                    break;
                }
            }
        }


        // --- UI Setup Functions ---

        function setupTesterUI(gamepad) {
            // Show main tester and hide status
            statusEl.style.display = 'none';
            containerEl.style.display = 'grid'; // Use grid for container
            statusEl.classList.remove('connected');

            // Set controller name
            controllerNameEl.textContent = gamepad.id;

            // Generate button UI
            buttonGridEl.innerHTML = ''; // Clear old buttons
            gamepad.buttons.forEach((button, index) => {
                const buttonEl = document.createElement('div');
                buttonEl.className = 'button';
                buttonEl.id = `btn-${index}`;
                buttonEl.innerHTML = `
                    B${index}
                    <span class="value">0.00</span>
                `;
                buttonGridEl.appendChild(buttonEl);
            });

            // Check for vibration (haptics)
            if (gamepad.vibrationActuator) {
                vibrationEl.style.display = 'block';
                setupVibrationButtons(gamepad.vibrationActuator);
            } else {
                vibrationEl.style.display = 'none';
            }
        }
        
        function resetTesterUI() {
            // Hide tester and show status
            statusEl.style.display = 'block';
            containerEl.style.display = 'none';
            statusEl.classList.remove('connected');
            statusEl.textContent = 'Controller disconnected. Please reconnect.';

            // Reset SVG visualizer
            document.querySelectorAll('#gamepad-svg .button-fill').forEach(el => {
                el.classList.remove('active-fill');
                el.style.fill = ''; // Reset to default CSS fill
                el.style.stroke = ''; // Reset trigger specific stroke
                el.style.strokeWidth = ''; // Reset trigger specific stroke-width
            });
            svgLeftStickPos.setAttribute('cx', baseLeftStickX);
            svgLeftStickPos.setAttribute('cy', baseLeftStickY);
            svgRightStickPos.setAttribute('cx', baseRightStickX);
            svgRightStickPos.setAttribute('cy', baseRightStickY);
        }
        
        function setupVibrationButtons(actuator) {
            vibrate1sBtn.onclick = () => {
                actuator.playEffect("dual-rumble", {
                    startDelay: 0,
                    duration: 1000, // 1 second
                    weakMagnitude: 0.8,
                    strongMagnitude: 0.8
                });
            };
            
            vibrateInfBtn.onclick = () => {
                actuator.playEffect("dual-rumble", {
                    startDelay: 0,
                    duration: 5 * 60 * 1000, // 5 minutes (as "infinite")
                    weakMagnitude: 0.5,
                    strongMagnitude: 0.5
                });
            };
            
            vibrateStopBtn.onclick = () => {
                // Stop by playing a 0-duration effect
                actuator.playEffect("dual-rumble", {
                    startDelay: 0,
                    duration: 0,
                    weakMagnitude: 0,
                    strongMagnitude: 0
                });
            };
        }

        // --- Main Update Loop ---

        function startUpdateLoop() {
            // Get the latest gamepad state
            // navigator.getGamepads() returns an array.
            // We need to re-fetch to get the updated button/axis states.
            const gamepads = navigator.getGamepads();
            const currentGamepadState = gamepads[connectedGamepad.index]; 
            
            if (currentGamepadState) {
                // Update all UI elements
                updateButtons(currentGamepadState.buttons);
                updateAxes(currentGamepadState.axes);
                updateGamepadVisualizer(currentGamepadState.buttons, currentGamepadState.axes);
                
                // Keep the loop running
                animationFrameId = requestAnimationFrame(startUpdateLoop);
            } else {
                // If the gamepad somehow disconnected without an event firing
                connectedGamepad = null;
                resetTesterUI();
                stopUpdateLoop();
            }
        }

        function stopUpdateLoop() {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
        }

        // --- UI Update Functions ---
        
        function updateButtons(buttons) {
            buttons.forEach((button, index) => {
                const buttonEl = document.getElementById(`btn-${index}`);
                if (buttonEl) {
                    const valueEl = buttonEl.querySelector('.value');
                    valueEl.textContent = button.value.toFixed(2);
                    
                    if (button.pressed) {
                        buttonEl.classList.add('pressed');
                        // For analog triggers, show partial press
                        if (index === 6 || index === 7) { // L2, R2
                             buttonEl.style.background = `linear-gradient(to top, #0078d7 ${button.value * 100}%, #333 ${button.value * 100}%)`;
                        } else {
                             buttonEl.style.background = ''; // Use CSS class for other buttons
                        }
                    } else {
                        buttonEl.classList.remove('pressed');
                        buttonEl.style.background = ''; // Reset to CSS default
                    }
                }
            });
        }

        function updateAxes(axes) {
            // Standard mapping:
            // axes[0] = Left Stick X (-1 to 1)
            // axes[1] = Left Stick Y (-1 to 1)
            // axes[2] = Right Stick X (-1 to 1)
            // axes[3] = Right Stick Y (-1 to 1)
            
            // Handle cases where controller has fewer than 4 axes
            const ls_x = axes[0] || 0;
            const ls_y = axes[1] || 0;
            const rs_x = axes[2] || 0;
            const rs_y = axes[3] || 0;
            
            // Draw sticks on canvas
            drawStick(lStickCtx, ls_x, ls_y);
            drawStick(rStickCtx, rs_x, rs_y);
            
            // Update text values
            lStickValuesEl.innerHTML = `Axis 0: ${ls_x.toFixed(4)}<br>Axis 1: ${ls_y.toFixed(4)}`;
            rStickValuesEl.innerHTML = `Axis 2: ${rs_x.toFixed(4)}<br>Axis 3: ${rs_y.toFixed(4)}`;
        }
        
        function drawStick(ctx, x, y) {
            const width = ctx.canvas.width;
            const height = ctx.canvas.height;
            const midX = width / 2;
            const midY = height / 2;
            const radius = width / 2 - 10; // Padding
            
            // Deadzone (optional, but good practice)
            const deadzone = 0.08;
            if (Math.abs(x) < deadzone) x = 0;
            if (Math.abs(y) < deadzone) y = 0;

            // --- Clear and draw background ---
            ctx.clearRect(0, 0, width, height);
            
            // Draw outer boundary circle
            ctx.beginPath();
            ctx.arc(midX, midY, radius, 0, 2 * Math.PI);
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Draw crosshairs
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(midX, 0);
            ctx.lineTo(midX, height);
            ctx.moveTo(0, midY);
            ctx.lineTo(width, midY);
            ctx.stroke();

            // --- Draw the stick position ---
            const stickX = midX + (x * radius);
            const stickY = midY + (y * radius);
            
            ctx.beginPath();
            ctx.arc(stickX, stickY, 8, 0, 2 * Math.PI);
            ctx.fillStyle = '#00aaff';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function updateGamepadVisualizer(buttons, axes) {
            // Reset all button fills
            document.querySelectorAll('#gamepad-svg .button-fill').forEach(el => {
                el.classList.remove('active-fill');
                el.style.fill = ''; // Reset to CSS default
                el.style.stroke = ''; // Reset trigger specific stroke
                el.style.strokeWidth = ''; // Reset trigger specific stroke-width
            });

            // Update button highlights
            buttons.forEach((button, index) => {
                const svgId = buttonMap[index];
                if (svgId) {
                    const svgElement = document.getElementById(svgId);
                    if (svgElement) {
                        if (button.pressed) {
                            // For analog triggers (B6, B7), use value to show partial press
                            if (index === 6 || index === 7) {
                                // For triggers, we'll blend the fill based on value
                                const intensity = button.value;
                                const defaultColor = [102, 102, 102]; // #666
                                const activeColor = [0, 170, 255]; // #00aaff
                                
                                const r = Math.round(defaultColor[0] * (1 - intensity) + activeColor[0] * intensity);
                                const g = Math.round(defaultColor[1] * (1 - intensity) + activeColor[1] * intensity);
                                const b = Math.round(defaultColor[2] * (1 - intensity) + activeColor[2] * intensity);
                                svgElement.style.fill = `rgb(${r},${g},${b})`;

                                // Also make the outline more prominent
                                svgElement.style.stroke = `#00aaff`;
                                svgElement.style.strokeWidth = '2px';
                            } else {
                                svgElement.classList.add('active-fill');
                            }
                        } else {
                            if (index === 6 || index === 7) { // Reset trigger styles
                                svgElement.style.fill = ''; // Reset to default CSS
                                svgElement.style.stroke = '';
                                svgElement.style.strokeWidth = '';
                            }
                        }
                    }
                }
            });

            // Update stick positions
            const ls_x = axes[0] || 0;
            const ls_y = axes[1] || 0;
            const rs_x = axes[2] || 0;
            const rs_y = axes[3] || 0;
            
            // Adjust max stick displacement on SVG for visualizer
            const stickMaxMove = 10; // Pixels
            
            // Left Stick
            svgLeftStickPos.setAttribute('cx', baseLeftStickX + (ls_x * stickMaxMove));
            svgLeftStickPos.setAttribute('cy', baseLeftStickY + (ls_y * stickMaxMove));

            // Right Stick
            svgRightStickPos.setAttribute('cx', baseRightStickX + (rs_x * stickMaxMove));
            svgRightStickPos.setAttribute('cy', baseRightStickY + (rs_y * stickMaxMove));
        }

    </script>
</body>
</html>
